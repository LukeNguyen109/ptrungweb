<!--Author: Phu Trung Nguyen
    Date: OCT 2025
    Description: táº¡o quÃ  sn á»§n ngu
-->
<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>Main menu</title>
  <link href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@700&family=Quicksand:wght@500&display=swap" rel="stylesheet">
  <style>
    :root{
      --sticker-gap: 140px; /* chá»‰nh sá»‘ nÃ y Ä‘á»ƒ nÃ© sticker */
    }
    body {
      
      /* background: radial-gradient(circle at center, #1b0034, #000); */
        background-image: url("static/CreasedPaper.jpg"); /* ÄÆ°á»ng dáº«n Ä‘áº¿n áº£nh ná»n */
        background-size: cover;       /* áº¢nh phá»§ toÃ n mÃ n hÃ¬nh */
        background-position: center;  /* CÄƒn giá»¯a áº£nh */
        background-repeat: no-repeat; /* KhÃ´ng láº·p láº¡i */
        font-family: 'Quicksand', sans-serif;
        color: white;
        text-align: center;
        height: 100vh;
        margin: 0;
        overflow: hidden;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
    }

    h1 {
      font-size: 4em;
      text-shadow: 0 0 15px #ff66ff;
      margin-bottom: 30px;
    }

    button {
      font-size: 1.5em;
      padding: 10px 25px;
      margin: 10px;
      border: none;
      border-radius: 10px;
      cursor: pointer;
      background-color: #ff66cc;
      color: white;
      box-shadow: 0 0 15px #ff99ff;
      transition: all 0.3s ease;
    }

    button:hover {
      background-color: #ff3399;
      transform: scale(1.1);
    }

    #message-box {
      background: rgba(0, 0, 0, 0.7);
      padding: 20px 40px;
      border-radius: 15px;
      box-shadow: 0 0 20px #ff66ff;
      display: none;
      flex-direction: column;
      align-items: center;
    }

    #message-box p {
      font-size: 1.5em;
      margin-bottom: 20px;
      color: #ffb3ff;
    }

    #angry-pig {
      width: 180px;
      height: auto;
      margin-bottom: 20px;
      animation: shake 0.8s infinite;
    }

    @keyframes shake {
      0% { transform: rotate(0deg); }
      25% { transform: rotate(5deg); }
      50% { transform: rotate(0deg); }
      75% { transform: rotate(-5deg); }
      100% { transform: rotate(0deg); }
    }
    /* ğŸ· Heo cháº¡y ngang */
    .running-pig {
      position: fixed;
      left: -200px;
      width: 120px;
      height: auto;
      z-index: 10;
      animation: runAcross 6s linear forwards;
      pointer-events: none; /* khÃ´ng cáº£n trá»Ÿ báº¥m nÃºt */
    }

    @keyframes runAcross {
      0% { left: -200px; transform: scaleX(1); }
      50% { transform: scaleX(1); }
      100% { left: 110vw; transform: scaleX(1); }
    }
    #corner-pig {
      position: absolute;
      top: 10px;
      right: 85px;
      width: 100px;
      height: auto;
      z-index: 2000;
      animation: pigFadeIn 1s ease-out;
    }

    @keyframes pigFadeIn {
      from { opacity: 0; transform: translateX(50px); }
      to { opacity: 1; transform: translateX(0); }
    }

    /* ğŸ· Heo bay tung ra tá»« bá»©c thÆ° */
    .flying-pig {
      position: fixed;
      width: 120px;
      height: auto;
      z-index: 1500;
      transform: translate(-50%, -50%) scale(0.8);
      animation: pigExplosion 3s ease-out forwards;
      pointer-events: none;
    }

    @keyframes pigExplosion {
      0% {
        opacity: 1;
        transform: translate(-50%, -50%) scale(1);
      }
      100% {
        opacity: 0;
        transform: translate(
          calc(-50% + (randX * 1px)),
          calc(-50% + (randY * 1px))
        ) scale(0.6);
      }
    }

    /* Sticker á»Ÿ gÃ³c dÆ°á»›i-trÃ¡i cá»§a panel feedback1 */
    #feedback1-popup .feedback1-sticker {
      position: absolute;
      left: -5px;      /* Ä‘áº©y ra ngoÃ i chÃºt cho cute */
      bottom: -5px;
      width: 150px;     /* chá»‰nh size tuá»³ áº£nh */
      height: auto;
      transform-origin: bottom left;

      z-index: 1;       /* náº±m dÆ°á»›i ná»™i dung náº¿u cáº§n */
      pointer-events: none; /* khÃ´ng cáº£n click/scroll */
      opacity: 0.95;
      filter: drop-shadow(0 0 10px rgba(255,102,255,0.25));
    }

    /* group textarea + hint + button láº¡i Ä‘á»ƒ canh Ä‘á»u */
    #feedback1-popup .fb1-form{
      width: 92%;
      margin: 12px auto 0;         /* form náº±m giá»¯a popup */

      padding-left: var(--sticker-gap);  /* chá»«a chá»— sticker á»Ÿ trÃ¡i */
      box-sizing: border-box;

      display: flex;
      flex-direction: column;
      gap: 12px;                   /* cÃ¡ch Ä‘á»u nhau */
      align-items: stretch;         /* con = full width theo form */
    }

    /* textarea full width theo form */
    #feedback1-popup #feedback1-input{
      width: 100%;
      margin: 0;
      display: block;
    }

    /* dÃ²ng hÆ°á»›ng dáº«n canh giá»¯a Ä‘Ãºng theo khung */
    #feedback1-popup .fb1-hint{
      width: 100%;
      margin: 0;
      text-align: center;     /* CANH GIá»®A */
      color:#fff;
      opacity:0.8;
      font-size:0.95em;
    }

    /* nÃºt gá»­i full width theo form */
    #feedback1-popup #feedback1-ok{
      width: 100%;
      margin: 10;
    }

    /* Sticker 2 bÃªn cho popup feedback2 */
    #feedback2-popup .fb2-panel{
      position: relative;     /* Ä‘á»ƒ sticker absolute bÃ¡m theo panel */
      overflow: visible;      /* cho phÃ©p sticker lÃ²i ra ngoÃ i */
    }

    #feedback2-popup .fb2-sticker{
      position: absolute;
      top: 50%;
      transform: translateY(-50%);
      width: 120px;           /* chá»‰nh size tuá»³ m */
      height: auto;
      z-index: 1;
      pointer-events: none;
      filter: drop-shadow(0 0 10px rgba(255,102,255,0.25));
      opacity: 0.95;
    }

    /* trÃ¡i */
    #feedback2-popup .fb2-sticker.left{
      left: -40px;            /* Ã¢m Ä‘á»ƒ lÃ²i ra ngoÃ i panel */
    }

    /* pháº£i */
    #feedback2-popup .fb2-sticker.right{
      right: -40px;
    }

    /* Responsive cho mÃ n hÃ¬nh nhá» */
    @media (max-width: 480px){
      #feedback2-popup .fb2-sticker{
        width: 90px;
      }
      #feedback2-popup .fb2-sticker.left{ left: -40px; }
      #feedback2-popup .fb2-sticker.right{ right: -40px; }
    }

    /* PNG á»Ÿ giá»¯a cáº¡nh trÃªn cá»§a final panel */
    #final-popup .final-panel{
      position: relative;   /* Ä‘á»ƒ áº£nh absolute bÃ¡m theo panel */
      overflow: visible;    /* cho áº£nh lÃ²i ra ngoÃ i panel náº¿u cáº§n */
    }

    #final-popup .final-top-sticker{
      position: absolute;
      top: 0;               /* neo vÃ o cáº¡nh trÃªn */
      left: 50%;            /* canh giá»¯a theo trá»¥c ngang */
      transform: translate(-50%, -110%); /* Ä‘áº©y lÃªn trÃªn cáº¡nh panel */
      width: 120px;         /* chá»‰nh size tuá»³ áº£nh */
      height: auto;
      z-index: 2;           /* náº±m trÃªn ná»™i dung panel */
      pointer-events: none; /* khÃ´ng cáº£n click nÃºt */
      filter: drop-shadow(0 0 10px rgba(255,102,255,0.25));
      opacity: 0.98;
    }

    /* responsive nhá» láº¡i trÃªn mobile */
    @media (max-width: 480px){
      #final-popup .final-top-sticker{ width: 110px; }
    }

  </style>
</head>
<body>
  <!-- Music permission popup -->
<div id="music-popup" style="
  position: fixed; inset: 0;
  background: rgba(0,0,0,0.55);
  display: flex; align-items: center; justify-content: center;
  z-index: 5000;
">
  <div style="
    width: min(420px, 90vw);
    background: rgba(0,0,0,0.75);
    border: 1px solid rgba(255,255,255,0.15);
    border-radius: 16px;
    padding: 18px 18px 14px;
    box-shadow: 0 0 24px rgba(255, 102, 255, 0.25);
    text-align: center;
  ">
    <div style="display:flex; justify-content: space-between; align-items:center;">
      <div style="font-size: 1.1em; color:#ffb3ff;">má»Ÿ tiáº¿ng nheğŸ«°ğŸ» </div>
      <button id="music-close" aria-label="Close" style="
        background: transparent; border: none; color:#ff66a3;
        font-size: 1.2em; cursor: pointer;
      ">âœ–</button>
    </div>

    <p style="margin: 12px 0 16px; color:#fff; opacity:0.9;">
      Ä‘á»ƒ khá»i cháº·n autoplay Ã¡, chá»‰nh volume coi chá»«ng Ä‘iáº¿c
    </p>

    <button id="music-yes" style="
      font-size: 1.1em;
      padding: 10px 18px;
      border: none;
      border-radius: 10px;
      cursor: pointer;
      background-color: #ff66cc;
      color: white;
      box-shadow: 0 0 15px #ff99ff;
    ">kÃª</button>
  </div>
</div>
<!-- Date quiz popup -->
<div id="date-popup" style="
  position: fixed; inset: 0;
  background: rgba(0,0,0,0.55);
  display: none;
  align-items: center; justify-content: center;
  z-index: 5500;
">
  <div style="
    width: min(420px, 90vw);
    background: rgba(0,0,0,0.78);
    border: 1px solid rgba(255,255,255,0.15);
    border-radius: 16px;
    padding: 18px 18px 14px;
    box-shadow: 0 0 24px rgba(255, 102, 255, 0.25);
    text-align: center;
  ">
    <div style="display:flex; justify-content: space-between; align-items:center;">
      <div style="font-size: 1.1em; color:#ffb3ff;">tháº¿ ngÃ y gÃ¬ nÃ³i coi ğŸ˜¼</div>
      <button id="date-close" aria-label="Close" style="
        background: transparent; border: none; color:#ff66a3;
        font-size: 1.2em; cursor: pointer;
      ">âœ–</button>
    </div>

    <p style="margin: 12px 0 10px; color:#fff; opacity:0.9;">
      hÃ£y nháº­p Ä‘Ãºng Ä‘á»ƒ Ä‘Æ°á»£c nháº­n quÃ  ğŸ
    </p>

    <input id="date-input" inputmode="numeric" placeholder="nháº­p dÃ´ Ä‘Ã¢y nÃ¨ cu" style="
      width: 70%;
      font-size: 1.1em;
      padding: 10px 12px;
      border-radius: 10px;
      border: 1px solid rgba(255,255,255,0.25);
      outline: none;
      text-align: center;
    " />

    <div id="date-error" style="margin-top:10px; color:#ff8fb3; display:none;">
      sai rá»“i ğŸ˜’ nháº­p láº¡i Ä‘i
    </div>

    <div style="margin-top: 14px;">
      <button id="date-submit">OK</button>
    </div>
  </div>
</div>

<!-- Congrats popup -->
<div id="congrats-popup" style="
  position: fixed; inset: 0;
  background: rgba(0,0,0,0.55);
  display: none;
  align-items: center; justify-content: center;
  z-index: 5600;
">
  <div style="
    width: min(420px, 90vw);
    background: rgba(0,0,0,0.78);
    border: 1px solid rgba(255,255,255,0.15);
    border-radius: 16px;
    padding: 18px 18px 16px;
    box-shadow: 0 0 24px rgba(255, 102, 255, 0.25);
    text-align: center;
  ">
    <div style="font-size: 1.15em; color:#ffb3ff; margin-bottom: 10px;">
      ThÃ´ng minh Ä‘áº¥y ğŸ˜<br> Trong 5s pháº£i click vÃ o con heo Ä‘á»ƒ nháº­n quÃ 
    </div>

    <div style="
      font-size: 3.2em;
      font-weight: 700;
      color: #fff;
      text-shadow: 0 0 18px #ff66ff;
      margin: 10px 0 4px;
    " id="countdown">5</div>

    <div style="color:#fff; opacity:0.85; margin-top: 6px;">
      Ä‘áº¿m ngÆ°á»£c xÃ­u nha...
    </div>
  </div>
</div>

<!-- ğŸ’¬ Feedback popup 1 -->
<div id="feedback1-popup" style="
  position: fixed; inset: 0;
  background: rgba(0,0,0,0.55);
  display: none;
  align-items: center; justify-content: center;
  z-index: 5700;
">
  <div style="
    width: min(520px, 92vw);
    background: rgba(0,0,0,0.78);
    border: 1px solid rgba(255,255,255,0.15);
    border-radius: 16px;
    padding: 18px 18px 16px;
    box-shadow: 0 0 24px rgba(255, 102, 255, 0.25);
    text-align: center;
    font-family: 'Quicksand', sans-serif;
    position: relative;
    overflow: visible;
  ">
  <img class="feedback1-sticker" src="static/un_like.png" alt="sticker" />
    <div style="display:flex; justify-content: space-between; align-items:flex-start;">
      <div style="font-size: 1.05em; color:#ffb3ff; text-align:left; line-height:1.4;">
        hehe láº§n Ä‘áº§u lÃ m web nÃªn k bt design xá»‹n xÃ²<br>
        cho xin tÃ­ chia sáº» nho
      </div>
      <button id="feedback1-close" aria-label="Close" style="
        background: transparent; border: none; color:#ff66a3;
        font-size: 1.2em; cursor: pointer;
      ">âœ–</button>
    </div>

    <div class="fb1-form">
      <textarea id="feedback1-input" rows="4" placeholder="gÃµ gÃ¬ Ä‘Ã³ rá»“i nháº¥n Enter..."
        style="
          font-size: 1.05em;
          padding: 10px 12px;
          border-radius: 10px;
          border: 1px solid rgba(255,255,255,0.25);
          outline: none;
          resize: none;
        "></textarea>

      <div class="fb1-hint">
          (Enter Ä‘á»ƒ gá»­i â€¢ Shift+Enter Ä‘á»ƒ xuá»‘ng dÃ²ng)
      </div>

      <button id="feedback1-ok" style="
        font-size: 1.05em;
        border: none;
        border-radius: 10px;
        cursor: pointer;
        background-color: #ff66cc;
        color: white;
        box-shadow: 0 0 15px #ff99ff;
        padding: 10px 18px;
      ">Gá»­i cho pt</button>
    </div>
  </div>
</div>

<!-- No-server popup 2 -->
<div id="feedback2-popup" style="
  position: fixed; inset: 0;
  background: rgba(0,0,0,0.55);
  display: none;
  align-items: center; justify-content: center;
  z-index: 5800;
">
  <div class="fb2-panel" style="
    width: min(520px, 92vw);
    background: rgba(0,0,0,0.78);
    border: 1px solid rgba(255,255,255,0.15);
    border-radius: 16px;
    padding: 18px 18px 16px;
    box-shadow: 0 0 24px rgba(255, 102, 255, 0.25);
    text-align: center;
    font-family: 'Quicksand', sans-serif;
  ">
    <!-- 2 sticker hai bÃªn -->
    <img class="fb2-sticker left"  src="static/un_om_cho.png" alt="sticker left">
    <img class="fb2-sticker right" src="static/un_khoe_qua.png" alt="sticker right">

    <div style="font-size: 1.05em; color:#ffb3ff; line-height:1.5; margin-bottom: 12px;">
      dá»¡n thÃ´i chá»© t Ä‘ cÃ³ server Ä‘á»ƒ coi láº¡i Ä‘Ã¢u kkk,<br>
      muá»‘n nÃ³i gÃ¬ thÃ¬ ig: <b>phutrungdeptraidangcapvcl</b>
    </div>

    <button id="feedback2-ok" style="
      font-size: 1.05em;
      padding: 10px 18px;
      border: none;
      border-radius: 10px;
      cursor: pointer;
      background-color: #ff66cc;
      color: white;
      box-shadow: 0 0 15px #ff99ff;
    ">OK</button>
  </div>
</div>

<!-- ğŸ‘€ Tab title popup 3 -->
<div id="feedback3-popup" style="
  position: fixed; inset: 0;
  background: rgba(0,0,0,0.55);
  display: none;
  align-items: center; justify-content: center;
  z-index: 5900;
">
  <div style="
    width: min(520px, 92vw);
    background: rgba(0,0,0,0.78);
    border: 1px solid rgba(255,255,255,0.15);
    border-radius: 16px;
    padding: 18px 18px 16px;
    box-shadow: 0 0 24px rgba(255, 102, 255, 0.25);
    text-align: center;
    font-family: 'Quicksand', sans-serif;
  ">
    <div style="display:flex; justify-content: space-between; align-items:center;">
      <div style="font-size: 1.05em; color:#ffb3ff;">
        <b><span style="text-decoration: underline;">btw náº¿u m k Ä‘á»ƒ Ã½ thÃ¬ nhÃ¬n tÃªn tab Ä‘i</span></b><br>
        náº¿u lá»¡ má»Ÿ nhiá»u tab quÃ¡ thÃ¬ Ä‘Ã³ng bá»›t Ä‘i <br>
        hoáº·c chá»‰ chuá»™t vÃ o nheğŸ«°ğŸ»
      </div>
      <button id="feedback3-close" aria-label="Close" style="
        background: transparent; border: none; color:#ff66a3;
        font-size: 1.2em; cursor: pointer;
      ">âœ–</button>
    </div>
  </div>
</div>

<!-- ğŸµ Remix quiz popup 4 -->
<div id="remix-popup" style="
  position: fixed; inset: 0;
  background: rgba(0,0,0,0.55);
  display: none;
  align-items: center; justify-content: center;
  z-index: 6000;
">
  <div style="
    width: min(520px, 92vw);
    background: rgba(0,0,0,0.78);
    border: 1px solid rgba(255,255,255,0.15);
    border-radius: 16px;
    padding: 18px 18px 16px;
    box-shadow: 0 0 24px rgba(255, 102, 255, 0.25);
    text-align: center;
    font-family: 'Quicksand', sans-serif;
    position: relative;
  ">
    <div style="display:flex; justify-content: space-between; align-items:center;">
      <div style="font-size: 1.05em; color:#ffb3ff; text-align:left; line-height:1.5;">
        Ãª mÃ  cÃ¡i bÃ i remix mÃ  bá»¯a m báº£o t<br>
        m thÃ­ch nháº¥t tÃªn gÃ¬ áº¥y nhá»<br>
      </div>

      <button id="remix-close" aria-label="Close" style="
        background: transparent; border: none; color:#ff66a3;
        font-size: 1.2em; cursor: pointer;
      ">âœ–</button>
    </div>

    <input id="remix-input" placeholder="gÃµ dÃ´ Ä‘Ã¢y nÃ¨..."
      style="
        width: 92%;
        margin-top: 14px;
        font-size: 1.05em;
        padding: 10px 12px;
        border-radius: 10px;
        border: 1px solid rgba(255,255,255,0.25);
        outline: none;
        text-align: center;
      " />

    <div id="remix-error" style="margin-top:10px; color:#ff8fb3; display:none;">
      ? bá»¯a m nÃ³i t Ä‘á»•i tÃ¬nh Ä‘á»•i Ã¡o mÃ 
    </div>

    <div style="margin-top: 14px;">
      <button id="remix-submit">OK</button>
    </div>
  </div>
</div>

<!-- ğŸ¬ Video overlay -->
<div id="video-popup" style="
  position: fixed; inset: 0;
  background: rgba(0,0,0,0.75);
  display: none;
  align-items: center; justify-content: center;
  z-index: 6100;
">
  <div style="
    width: min(900px, 92vw);
    max-height: 85vh;
    position: relative;
  ">
    <video id="cc-video" src="static/cc.mp4"
      style="
        width: 100%;
        max-height: 85vh;
        border-radius: 16px;
        box-shadow: 0 0 24px rgba(255, 102, 255, 0.25);
        background: #000;
      "
      playsinline
      controls
    ></video>
  </div>
</div>

<!-- Final popup -->
<div id="final-popup" style="
  position: fixed; inset: 0;
  background: rgba(0,0,0,0.55);
  display: none;
  align-items: center; justify-content: center;
  z-index: 6200;
">
  <div class="final-panel" style="
    width: min(520px, 92vw);
    background: rgba(0,0,0,0.78);
    border: 1px solid rgba(255,255,255,0.15);
    border-radius: 16px;
    padding: 18px 18px 16px;
    box-shadow: 0 0 24px rgba(255, 102, 255, 0.25);
    text-align: center;
    font-family: 'Quicksand', sans-serif;
  ">
    <!-- PNG á»Ÿ giá»¯a cáº¡nh trÃªn -->
    <img class="final-top-sticker" src="static/snvv_nghen.jpg" alt="sticker final">

    <div style="font-size: 1.15em; color:#ffb3ff; line-height:1.6;">
      háº¿t rui do, snvv nghen
    </div>

    <div style="margin-top: 14px;">
      <button id="final-home">vá» main menu</button>
    </div>
  </div>
</div>

  <h1>Ãª á»§n biáº¿t nay ngÃ y gÃ¬ kh cu?</h1>
  <div id="menu">
    <button id="yes">CÃ³ ğŸ˜</button>
    <button id="no">KhÃ´ng ğŸ˜’</button>
  </div>

  <div id="message-box">
    <img id="angry-pig" src="static/angryPig.gif" alt="Angry Pig">
    <p>m tá»‡ vcl ğŸ˜¤ chá»n "CÃ³" Ä‘i Ä‘á»“ ngu ğŸ˜¡</p>
    <button id="ok">OK ğŸ™„</button>
  </div>

<script>
  const yesBtn = document.getElementById("yes");
  const noBtn = document.getElementById("no");
  const okBtn = document.getElementById("ok");
  const menu = document.getElementById("menu");
  const messageBox = document.getElementById("message-box");
  const fb1Ok = document.getElementById("feedback1-ok");

  
  // =======================
  // AUDIO SETUP
  // =======================
  const track1 = new Audio("static/1.mp3");
  const track2 = new Audio("static/2.mp3");
  const trackNo = new Audio("static/saomayngutheha.mp3");

  //  loop thÃ¬ báº­t
  track1.loop = true;
  track2.loop = false;
  trackNo.loop = false;
  trackNo.playsInline = true;

  trackNo.addEventListener("ended", () => {
    play1();
  });
  track2.addEventListener("ended", () => {
    play1();
  });

  // iOS hay cáº§n play inline
  track1.playsInline = true;
  track2.playsInline = true;

  function stopAll() {
  [track1, track2, trackNo].forEach(a => {
    a.pause();
    a.currentTime = 0;
  });
}

  async function playTrack(audio) {
    try {
      await audio.play();
    } catch (e) {
      // náº¿u váº«n bá»‹ cháº·n (hiáº¿m), Ã­t nháº¥t khÃ´ng crash
      console.warn("Audio play blocked:", e);
    }
  }

  function play1() { stopAll(); playTrack(track1); }
  function play2() { stopAll(); playTrack(track2); }

  // =======================
  // ğŸµ MUSIC POPUP (anti-autoplay-block)
  // =======================
  const musicPopup = document.getElementById("music-popup");
  const musicYes = document.getElementById("music-yes");
  const musicClose = document.getElementById("music-close");

  // Má»Ÿ trang -> hiá»‡n popup (máº·c Ä‘á»‹nh Ä‘Ã£ hiá»‡n báº±ng style)
  // Báº¥m "CÃ³" trong popup -> phÃ¡t 1.mp3
  musicYes.addEventListener("click", () => {
    musicPopup.style.display = "none";
    play1();
  });

  // Báº¥m âœ– popup -> táº¯t nháº¡c (hoáº·c báº¡n muá»‘n váº«n phÃ¡t thÃ¬ tuá»³)
  musicClose.addEventListener("click", () => {
    musicPopup.style.display = "none";
    stopAll();
  });

  // =======================
// ğŸ’¬ FEEDBACK POPUPS FLOW
// =======================
const fb1Popup = document.getElementById("feedback1-popup");
const fb1Input = document.getElementById("feedback1-input");
const fb1Close = document.getElementById("feedback1-close");

const fb2Popup = document.getElementById("feedback2-popup");
const fb2Ok = document.getElementById("feedback2-ok");

const fb3Popup = document.getElementById("feedback3-popup");
const fb3Close = document.getElementById("feedback3-close");

function showFeedback1() {
  fb1Popup.style.display = "flex";
  fb1Input.value = "";
  setTimeout(() => fb1Input.focus(), 0);
}

function hideFeedback1() {
  fb1Popup.style.display = "none";
}

function showFeedback2() {
  fb2Popup.style.display = "flex";
}

function hideFeedback2() {
  fb2Popup.style.display = "none";
}

function showFeedback3() {
  fb3Popup.style.display = "flex";
  document.title = "ptrung dcap vcl á»§n thÃ¬ nerd";
}

function hideFeedback3() {
  fb3Popup.style.display = "none";
  // quay vá» menu chÃ­nh
  menu.style.display = "block";
  messageBox.style.display = "none";
}

// Close popup 1 -> bá» qua luÃ´n vÃ  quay vá» menu
fb1Close.addEventListener("click", () => {
  hideFeedback1();
  menu.style.display = "block";
});

// Enter Ä‘á»ƒ gá»­i (Shift+Enter Ä‘á»ƒ xuá»‘ng dÃ²ng)
fb1Input.addEventListener("keydown", (e) => {
  if (e.key === "Enter" && !e.shiftKey) {
    e.preventDefault();
    hideFeedback1();
    showFeedback2();
  }
});

fb1Ok.addEventListener("click", () => {
  hideFeedback1();
  showFeedback2();
});

fb2Ok.addEventListener("click", () => {
  hideFeedback2();
  showFeedback3();
}); 

const remixPopup  = document.getElementById("remix-popup");
const remixInput  = document.getElementById("remix-input");
const remixSubmit = document.getElementById("remix-submit");
const remixClose  = document.getElementById("remix-close");
const remixError  = document.getElementById("remix-error");

const videoPopup  = document.getElementById("video-popup");
const ccVideo     = document.getElementById("cc-video");

const finalPopup  = document.getElementById("final-popup");
const finalHome   = document.getElementById("final-home");

function showRemixPopup() {
  remixPopup.style.display = "flex";
  remixError.style.display = "none";
  remixInput.value = "";
  setTimeout(() => remixInput.focus(), 0);
}
function hideRemixPopup() {
  remixPopup.style.display = "none";
}

function showVideo() {
  stopAll();
  videoPopup.style.display = "flex";
  // Ä‘áº£m báº£o video vá» Ä‘áº§u & play
  ccVideo.currentTime = 0;
  const p = ccVideo.play();
  if (p && typeof p.catch === "function") p.catch(()=>{});
}

function hideVideo() {
  ccVideo.pause();
  videoPopup.style.display = "none";
}

function showFinalPopup() {
  finalPopup.style.display = "flex";
}
function hideFinalPopup() {
  finalPopup.style.display = "none";
}

function submitRemix() {
  const raw = remixInput.value || "";
  const v = normaliseText(raw); // m Ä‘Ã£ cÃ³ normaliseText á»Ÿ trÃªn rá»“i

  const answers = [
    "doi tinh doi ao",
    "doi tinh doi ao remix"
  ];

  if (answers.includes(v)) {
    hideRemixPopup();
    showVideo();
  } else {
    remixError.style.display = "block";
    remixInput.focus();
    remixInput.select();
  }
}

remixSubmit.addEventListener("click", submitRemix);
remixInput.addEventListener("keydown", (e) => {
  if (e.key === "Enter") submitRemix();
});

remixClose.addEventListener("click", () => {
  // náº¿u m muá»‘n báº¥m X thÃ¬ vá» main menu luÃ´n:
  hideRemixPopup();
  menu.style.display = "block";
  play1();
});

// Video play xong -> panel cuá»‘i
ccVideo.addEventListener("ended", () => {
  hideVideo();
  showFinalPopup();
});

// NÃºt vá» main menu
finalHome.addEventListener("click", () => {
  hideFinalPopup();
  menu.style.display = "block";
  play1();
});

// override hÃ nh vi close feedback3: khÃ´ng vá» main menu ná»¯a, mÃ  Ä‘i sang remix popup
fb3Close.addEventListener("click", () => {
  fb3Popup.style.display = "none"; // hideFeedback3() cÅ© cÃ³ báº­t menu láº¡i, nÃªn nÃ© nÃ³
  showRemixPopup();
});



  // Khi báº¥m "CÃ³" â†’ Hiá»‡n bá»©c thÆ°
  function openLetter() {
    const letterBox = document.createElement("div");
    letterBox.innerHTML = `
      <div id="letter-container">
        <div id="letter">
          <button id="close-letter">âœ–</button>
          <div class="scrollable">
            <h3>Happy birthday á»§n nho ğŸ‚</h3>
            <p>HAPPY BIRTHDAY ç”Ÿæ—¥å¿«ä¹. cá»§a Ã­t lÃ²ng vÃ²ng váº­y ha an á»§i cÃ¡i tinh tháº§n bro ng hanoi cháº©t.</p>
            <p>tháº¥y cÃ¢u nÃ y quen khÃ´ng=)) ban Ä‘áº§u tÃ­nh ra hnoi Ä‘Ãºng snhat Ã´ng Ä‘Ã³ nhma kco ká»‹p Ä‘á»ƒ hoÃ n thÃ nh cÃ¡i intern dm.</p>
            <p>thÃ´i thÃ¬ Ã´ng nháº­n Ä‘á»¡ cnay Ä‘i ha rá»“i tui ra hnoi mÃ¬nh quáº©y sau.</p>
            <p>chÃºc Ã´ng 8386 chÃºc Ã´ng táº¥t cáº£ nhÆ°ng khÃ´ng dÃ¡m chÃºc há»c tá»‘t:) lÃ½ do thÃ¬ bt r do...</p>
            <p>z Ä‘i ha CHÃšC Má»ªNG SINH NHáº¬TğŸ’”â¤ï¸â€ğŸ©¹â¤ï¸ğŸ«€</p>
          </div>
        </div>
      </div>
    `;
    document.body.appendChild(letterBox);

        // Heo ná»• tung liÃªn tá»¥c tá»« mÃ©p bá»©c thÆ°
        function spawnHeartPigs() {
          const pigs = ["static/cute-pig.webp", "static/love-squeeze.webp"];
          const letter = document.getElementById("letter");

          if (!letter) return;

          for (let i = 0; i < 3; i++) {  // sá»‘ lÆ°á»£ng má»—i Ä‘á»£t burst
            const pig = document.createElement("img");
            pig.src = pigs[Math.floor(Math.random() * pigs.length)];
            pig.className = "flying-pig";

            // Láº¥y kÃ­ch thÆ°á»›c & vá»‹ trÃ­ cá»§a bá»©c thÆ°
            const rect = letter.getBoundingClientRect();
            const side = Math.floor(Math.random() * 4); // 0: top, 1: right, 2: bottom, 3: left
            let startX, startY;

            if (side === 0) { // trÃªn
              startX = rect.left + Math.random() * rect.width;
              startY = rect.top;
            } else if (side === 1) { // pháº£i
              startX = rect.right;
              startY = rect.top + Math.random() * rect.height;
            } else if (side === 2) { // dÆ°á»›i
              startX = rect.left + Math.random() * rect.width;
              startY = rect.bottom;
            } else { // trÃ¡i
              startX = rect.left;
              startY = rect.top + Math.random() * rect.height;
            }

            pig.style.left = `${startX}px`;
            pig.style.top = `${startY}px`;
            document.body.appendChild(pig);

            // HÆ°á»›ng bay ngáº«u nhiÃªn
            const angle = Math.random() * 2 * Math.PI;
            const distance = 200 + Math.random() * 150;
            const x = Math.cos(angle) * distance;
            const y = Math.sin(angle) * distance;

            pig.animate(
              [
                { opacity: 1, transform: "translate(0, 0) scale(1)" },
                { opacity: 0, transform: `translate(${x}px, ${y}px) scale(0.6)` }
              ],
              { duration: 2500, easing: "ease-out", fill: "forwards" }
            );

            setTimeout(() => pig.remove(), 2500);
          }
        }
        const burstInterval = setInterval(spawnHeartPigs, 800); // cá»© 0.8s ná»• 1 Ä‘á»£t

    // Hiá»‡n heo á»Ÿ gÃ³c pháº£i khi má»Ÿ thÆ°
    const cornerPig = document.createElement("img");
    cornerPig.src = "static/unlaclu.webp"; // hoáº·c chá»‰nh Ä‘Æ°á»ng dáº«n náº¿u khÃ¡c
    cornerPig.id = "corner-pig";
    letterBox.querySelector("#letter").appendChild(cornerPig);


    // CSS popup
    if (!document.getElementById("letter-style")) {
      const style = document.createElement("style");
      style.textContent = `
        #letter-container {
          position: fixed;
          top: 0; left: 0;
          width: 100vw; height: 100vh;
          background: rgba(0,0,0,0.4);
          display: flex;
          justify-content: center;
          align-items: center;
          z-index: 999;
        }

        #letter {
          width: 500px;
          max-height: 75vh;
          background: #fff;
          border-radius: 20px;
          box-shadow: 0 0 25px rgba(255,180,200,0.5);
          padding: 120px 50px 40px 60px; /* top right bottom left */
          text-align: left;
          font-family: 'Quicksand', sans-serif;
          position: relative;
          background-image: url('static/cutePigFrame.jpg');
          background-size: 100% 100%;
          background-position: center;
          background-repeat: no-repeat;
          animation: fadeIn 0.6s ease-out;
        }

        #letter h2 {
          text-align: center;
          color: #ff6699;
          font-family: 'Dancing Script', cursive;
          margin-bottom: 5px;
        }

        #letter h3 {
          text-align: center;
          color: #ff4da6;
          margin-bottom: 15px;
          font-size: 1.2em;
        }

        .scrollable {
          overflow-y: auto;
          max-height: 48vh;
          padding-right: 10px;
          margin-top: 10px;
        }

        #letter p {
          color: #333;
          font-size: 1.05em;
          line-height: 1.6;
          margin-bottom: 15px;
          text-align: left;     /* cÄƒn trÃ¡i ná»™i dung */
          margin-left: 15px;    /* Ä‘áº©y nháº¹ chá»¯ vÃ o trong Ä‘á»ƒ khÃ´ng sÃ¡t khung */
          margin-right: 15px;   /* giá»¯ khoáº£ng Ä‘á»u hai bÃªn */
        }

        #close-letter {
          position: absolute;
          top: 12px; right: 18px;
          background: transparent;
          border: none;
          font-size: 1.2em;
          cursor: pointer;
          color: #ff66a3;
          transition: 0.3s;
        }

        #close-letter:hover {
          transform: scale(1.2);
          color: #ff3399;
        }

        @keyframes fadeIn {
          from {opacity: 0; transform: scale(0.8);}
          to {opacity: 1; transform: scale(1);}
        }

        /* Thanh cuá»™n má»m máº¡i */
        .scrollable::-webkit-scrollbar {
          width: 6px;
        }
        .scrollable::-webkit-scrollbar-thumb {
          background: #ffcce0;
          border-radius: 10px;
        }
      `;
      document.head.appendChild(style);
    }

    // NÃºt Ä‘Ã³ng popup
    document.getElementById("close-letter").addEventListener("click", () => {
      clearInterval(burstInterval);
      letterBox.remove();
      const cornerPig = document.getElementById("corner-pig");
      if (cornerPig) cornerPig.remove();
      play1();
      showFeedback1();
    });
}
const datePopup = document.getElementById("date-popup");
const dateInput = document.getElementById("date-input");
const dateSubmit = document.getElementById("date-submit");
const dateClose = document.getElementById("date-close");
const dateError = document.getElementById("date-error");
const congratsPopup = document.getElementById("congrats-popup");
const countdownEl = document.getElementById("countdown");
let countdownTimer = null;

function showCongratsThenOpenLetter() {
  // Ä‘Ã³ng popup nháº­p
  datePopup.style.display = "none";

  // hiá»‡n popup chÃºc má»«ng
  congratsPopup.style.display = "flex";

  // reset countdown
  let n = 5;
  countdownEl.textContent = String(n);

  // clear timer cÅ© náº¿u cÃ³
  if (countdownTimer) clearInterval(countdownTimer);

  countdownTimer = setInterval(() => {
    n -= 1;
    countdownEl.textContent = String(n);

    if (n <= 0) {
      clearInterval(countdownTimer);
      countdownTimer = null;
      congratsPopup.style.display = "none";
      openLetter(); // âœ… sau 5 giÃ¢y má»›i má»Ÿ thÆ°
    }
  }, 1000);
}

function normaliseDate(s) {
  s = (s || "").trim().replace(/[-.]/g, "/");
  if (/^\d{4}$/.test(s)) s = s.slice(0,2) + "/" + s.slice(2);

  const m = s.match(/^(\d{1,2})\/(\d{1,2})$/);
  if (!m) return s;

  const dd = String(parseInt(m[1], 10)).padStart(2, "0");
  const mm = String(parseInt(m[2], 10)).padStart(2, "0");
  return `${dd}/${mm}`;
}
function normaliseText(s) {
  return (s || "")
    .toLowerCase()
    .normalize("NFD")                 // tÃ¡ch dáº¥u
    .replace(/[\u0300-\u036f]/g, "")  // xoÃ¡ dáº¥u
    .trim();
}

function submitDate() {
  const correctAnswers = [
    "14/01",
    "sn bo",
    "sn tao",
    "sn un",
    "sinh nhat un",
    "sinh nhat bo"
  ];

  const raw = dateInput.value;
  const vDate = normaliseDate(raw);
  const vText = normaliseText(raw);

  if (correctAnswers.includes(vDate) || correctAnswers.includes(vText)) {
    play2();  
    showCongratsThenOpenLetter();   
  } else {
    dateError.style.display = "block";
    dateInput.focus();
    dateInput.select();
  }
}


dateSubmit.addEventListener("click", submitDate);
dateInput.addEventListener("keydown", (e) => {
  if (e.key === "Enter") submitDate();
});
dateClose.addEventListener("click", () => {
  datePopup.style.display = "none";
});
datePopup.addEventListener("click", (e) => {
  if (e.target === datePopup) datePopup.style.display = "none";
});

yesBtn.addEventListener("click", () => {
  // má»Ÿ popup há»i ngÃ y
  document.getElementById("date-popup").style.display = "flex";
  document.getElementById("date-error").style.display = "none";
  const inp = document.getElementById("date-input");
  inp.value = "";
  inp.focus();
});
  // NÃºt "KhÃ´ng" vÃ  "OK" giá»¯ nguyÃªn
  noBtn.addEventListener("click", () => {
    stopAll();
    playTrack(trackNo);
    menu.style.display = "none";
    messageBox.style.display = "flex";
  });
  okBtn.addEventListener("click", () => {
    messageBox.style.display = "none";
    menu.style.display = "block";
    // play1();
  });
</script>
<script>
  // HÃ m táº¡o con heo cháº¡y ngang
  function spawnRunningPig(forceAtTitle = false) {
    const pig = document.createElement("img");
    pig.src = "static/runningPig.gif";
    pig.className = "running-pig";

    // náº¿u lÃ  láº§n Ä‘áº§u tiÃªn â†’ Ä‘áº·t Ä‘Ãºng vá»‹ trÃ­ dÃ²ng tiÃªu Ä‘á»
    if (forceAtTitle) {
      const title = document.querySelector("h1");
      const titleRect = title.getBoundingClientRect();
      const topPosition = titleRect.top + titleRect.height / 2; // giá»¯a dÃ²ng chá»¯
      pig.style.top = topPosition + "px";
    } else {
      // cÃ¡c láº§n sau thÃ¬ random
      const randomTop = Math.random() * 70 + 10; // tá»« 10% Ä‘áº¿n 80% mÃ n hÃ¬nh
      pig.style.top = randomTop + "%";
    }

    document.body.appendChild(pig);

    // tá»± xÃ³a sau khi cháº¡y qua
    setTimeout(() => pig.remove(), 6000);
  }

  // Khi táº£i trang xong thÃ¬ cháº¡y 1 láº§n ngang qua dÃ²ng chá»¯,
  // sau Ä‘Ã³ cá»© má»—i 4 giÃ¢y láº¡i cháº¡y ngáº«u nhiÃªn
  window.addEventListener("load", () => {
    spawnRunningPig(true); // cháº¡y Ä‘áº§u tiÃªn ngang qua dÃ²ng chá»¯
    setInterval(spawnRunningPig, 6000); // sau Ä‘Ã³ má»—i 6 giÃ¢y
  });
</script>


</body>
</html>
